import { convertDuration } from '@date-vir/duration';
import { DeferredPromise } from './deferred-promise.js';
/**
 * An async pause for the given duration.
 *
 * @category Promise
 * @category Package : @augment-vir/common
 * @package [`@augment-vir/common`](https://www.npmjs.com/package/@augment-vir/common)
 * @see
 * - {@link waitValue} : return a value after the wait finishes.
 */
export function wait(duration) {
    const deferredPromise = new DeferredPromise();
    const isInfinity = Object.values(duration).some((value) => value === Infinity || value === -Infinity);
    const milliseconds = isInfinity
        ? Infinity
        : convertDuration(duration, { milliseconds: true }).milliseconds;
    if (milliseconds !== Infinity && milliseconds !== -Infinity) {
        setTimeout(() => {
            deferredPromise.resolve();
        }, milliseconds <= 0 ? 0 : milliseconds);
    }
    return deferredPromise.promise;
}
/**
 * An async pause for the given duration that then returns the given `value`.
 *
 * @category Promise
 * @category Package : @augment-vir/common
 * @package [`@augment-vir/common`](https://www.npmjs.com/package/@augment-vir/common)
 * @see
 * - {@link wait} : plain wait.
 */
export async function waitValue(duration, value) {
    await wait(duration);
    return value;
}
