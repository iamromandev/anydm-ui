import type { BuiltinsWithOptionalParams } from 'svgo/plugins/plugins-types';
import type { CompileOptions } from '@mdx-js/mdx';
import type { Config } from 'svgo';
import { ConfigEnv } from 'vite';
import type { Plugin as Plugin_2 } from 'vite';
import type { PluginOption } from 'vite';
import type { SerializationStrategy } from '@qwik.dev/core/internal';
import { UserConfigExport } from 'vite';

declare interface BuiltEntry extends ParsedPathname {
    id: string;
    chunkFileName: string;
    filePath: string;
}

declare interface BuiltLayout {
    filePath: string;
    dirPath: string;
    id: string;
    layoutType: 'top' | 'nested';
    layoutName: string;
}

declare interface BuiltRoute extends ParsedPathname {
    /** Unique id built from its relative file system path */
    id: string;
    /** Local file system path */
    filePath: string;
    ext: string;
    /** URL Pathname */
    pathname: string;
    layouts: BuiltLayout[];
}

/** @public */
export declare function extendConfig(baseConfigExport: UserConfigExport, serverConfigExport: UserConfigExport): (env: ConfigEnv) => Promise<Record<string, any>>;

/** @public */
declare interface ImageOptimizationOptions {
    jsxDirectives?: {
        quality?: `${number}`;
        format?: 'webp' | 'avif' | 'png';
        w?: string;
        h?: string;
        [key: string]: string | undefined;
    };
    svgo?: Pick<Config, 'floatPrecision' | 'multipass' | 'plugins'> & {
        defaultPresetOverrides?: BuiltinsWithOptionalParams['preset-default']['overrides'];
        prefixIds?: BuiltinsWithOptionalParams['prefixIds'] | false;
    };
    enabled?: boolean | 'only-production';
}

/** @public */
export declare type MdxOptions = CompileOptions;

declare interface MdxPlugins {
    remarkGfm: boolean;
    rehypeSyntaxHighlight: boolean;
    rehypeAutolinkHeadings: boolean;
}

declare type P<T> = Plugin_2<T> & {
    api: T;
};

declare interface ParsedPathname {
    routeName: string;
    pattern: RegExp;
    paramNames: string[];
    segments: PathnameSegment[];
}

declare type PathnameSegment = PathnameSegmentPart[];

declare interface PathnameSegmentPart {
    content: string;
    dynamic: boolean;
    rest: boolean;
}

/** @public */
declare interface PluginOptions {
    /** Directory of the `routes`. Defaults to `"src/routes"`. */
    routesDir?: string;
    /** Directory of the `server plugins`. Defaults to `routesDir`. */
    serverPluginsDir?: string;
    /**
     * The base pathname is used to create absolute URL paths up to the `hostname`, and must always
     * start and end with a `/`. Defaults to `"/""`.
     */
    basePathname?: string;
    /**
     * Ensure a trailing slash ends page urls. Defaults to `true`. (Note: Previous versions defaulted
     * to `false`).
     */
    trailingSlash?: boolean;
    /** Enable or disable MDX plugins included by default in qwik-router. */
    mdxPlugins?: MdxPlugins;
    /** MDX Options https://mdxjs.com/ */
    mdx?: any;
    /** The platform object which can be used to mock the Cloudflare bindings. */
    platform?: Record<string, unknown>;
    /** Configuration to rewrite url paths */
    rewriteRoutes?: RewriteRouteOption[];
    /** The serialization strategy for route loaders. Defaults to `never`. */
    defaultLoadersSerializationStrategy?: SerializationStrategy;
}

/**
 * @deprecated Use `qwikRouter` instead. Will be removed in V3
 * @public
 */
export declare function qwikCity(userOpts?: QwikCityVitePluginOptions): PluginOption[];

/**
 * @deprecated Use `QwikRouterPlugin` instead. Will be removed in V3
 * @public
 */
export declare type QwikCityPlugin = QwikRouterPlugin;

/**
 * @deprecated Use `QwikRouterVitePluginOptions` instead. Will be removed in V3
 * @public
 */
export declare type QwikCityVitePluginOptions = QwikRouterVitePluginOptions;

/** @public */
export declare function qwikRouter(userOpts?: QwikRouterVitePluginOptions): PluginOption[];

/** @public */
export declare interface QwikRouterPlugin extends P<QwikRouterPluginApi> {
    name: 'vite-plugin-qwik-router';
}

/** @public */
declare interface QwikRouterPluginApi {
    getBasePathname: () => string;
    getRoutes: () => BuiltRoute[];
    getServiceWorkers: () => BuiltEntry[];
}

/** @public */
export declare interface QwikRouterVitePluginOptions extends Omit<PluginOptions, 'basePathname'> {
    mdxPlugins?: MdxPlugins;
    mdx?: MdxOptions;
    platform?: Record<string, unknown>;
    imageOptimization?: ImageOptimizationOptions;
    /** Whether to use static imports for route modules (layout and index files). Defaults to `false`. */
    staticImportRoutes?: boolean;
    /**
     * Qwik is an SSR first framework. This means that Qwik requires either SSR or SSG. In Vite dev
     * mode the dev SSR server is responsible for rendering and pausing the application on the
     * server.
     *
     * Under normal circumstances this should be on, unless you have your own dev SSR server setup and
     * wish to disable this one.
     *
     * Default: true
     */
    devSsrServer?: boolean;
}

/** @public */
declare interface RewriteRouteOption {
    prefix?: string;
    paths: Record<string, string>;
}

export { }
