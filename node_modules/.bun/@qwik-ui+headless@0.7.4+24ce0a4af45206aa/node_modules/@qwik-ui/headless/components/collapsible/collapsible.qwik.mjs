import { jsx } from "@builder.io/qwik/jsx-runtime";
import { component$, useSignal, useId, useTask$, $, useContextProvider, Slot } from "@builder.io/qwik";
import { collapsibleContextId } from "./collapsible-context.qwik.mjs";
import { isBrowser } from "@builder.io/qwik/build";
import { useCollapsible } from "./use-collapsible.qwik.mjs";
const HCollapsible = component$((props) => {
  const { disabled, onOpenChange$, onChange$, "bind:open": givenIsOpenSig, id, triggerRef: givenTriggerRef, collapsible = true, open, accordionItem, ...rest } = props;
  const defaultOpenSig = useSignal(open ?? false);
  const isOpenSig = givenIsOpenSig ?? defaultOpenSig;
  const defaultTriggerRef = useSignal();
  const triggerRef = givenTriggerRef ?? defaultTriggerRef;
  const contentRef = useSignal();
  const contentHeightSig = useSignal(null);
  const { getHiddenHeight } = useCollapsible();
  const localId = useId();
  const itemId = id ?? localId;
  useTask$(function onOpenChangeTask({ track }) {
    track(() => isOpenSig.value);
    if (isBrowser) {
      onOpenChange$?.(isOpenSig.value);
      onChange$?.(isOpenSig.value);
    }
  });
  const getContentDimensions$ = $(async () => {
    if (!contentRef.value) {
      throw new Error("Qwik UI: There is no reference to the collapsible content element. Make sure to wrap the content in a <CollapsibleContent> component.");
    }
    if (contentHeightSig.value === null) {
      contentHeightSig.value = await getHiddenHeight(contentRef.value);
    }
    if (contentHeightSig.value !== 0) {
      contentRef.value.style.setProperty("--qwikui-collapsible-content-height", `${contentHeightSig.value}px`);
      if (accordionItem) {
        contentRef.value.style.setProperty("--qwikui-accordion-content-height", `${contentHeightSig.value}px`);
      }
    }
  });
  const context = {
    isOpenSig,
    itemId,
    triggerRef,
    contentRef,
    contentHeightSig,
    getContentDimensions$,
    disabled,
    collapsible
  };
  useContextProvider(collapsibleContextId, context);
  return /* @__PURE__ */ jsx("div", {
    id: itemId,
    "data-collapsible": true,
    "data-disabled": context.disabled ? "" : void 0,
    "data-open": context.isOpenSig.value ? "" : void 0,
    "data-closed": !context.isOpenSig.value ? "" : void 0,
    "aria-live": "polite",
    ...rest,
    children: /* @__PURE__ */ jsx(Slot, {})
  });
});
export {
  HCollapsible
};
