import { jsx } from "@builder.io/qwik/jsx-runtime";
import { component$, useComputed$, useTask$, useContextProvider, Slot } from "@builder.io/qwik";
import { ProgressContext } from "./progress-context.qwik.mjs";
import { useBoundSignal } from "../../utils/bound-signal.qwik.mjs";
const ProgressRoot = component$((props) => {
  const { "bind:value": givenValueSig, ...rest } = props;
  const defaultMax = 100;
  const minSig = useComputed$(() => props.min ?? 0);
  const maxSig = useComputed$(() => props.max ?? defaultMax);
  const valueSig = useBoundSignal(givenValueSig, props.value ?? null);
  useTask$(({ track }) => {
    if (props.value === void 0) return;
    track(() => props.value);
    valueSig.value = props.value;
  });
  const isValidProgressSig = useComputed$(() => {
    const isMaxFinite = Number.isFinite(maxSig.value);
    const isMaxGreaterThanMin = maxSig.value > minSig.value;
    const isValueValid = valueSig.value === null || valueSig.value >= minSig.value;
    return isMaxFinite && isMaxGreaterThanMin && isValueValid;
  });
  const valueLabelSig = useComputed$(() => {
    const value = valueSig.value ?? minSig.value;
    const range = maxSig.value - minSig.value;
    if (props.getValueLabel) {
      return props.getValueLabel(value, maxSig.value);
    }
    return `${Math.round((value - minSig.value) / range * 100)}%`;
  });
  useTask$(function checkValidProgress({ track }) {
    track(() => isValidProgressSig.value);
    if (!isValidProgressSig.value) {
      throw new Error("Qwik UI: Progress component must be a finite number, and within the max and min range.");
    }
  });
  const progressSig = useComputed$(() => {
    if (valueSig.value == null) return "indeterminate";
    const range = maxSig.value - minSig.value;
    const progress = (valueSig.value - minSig.value) / range;
    return progress >= 1 ? "complete" : "loading";
  });
  const dataAttributesSig = useComputed$(() => {
    return {
      "data-progress": progressSig.value,
      "data-value": valueSig.value ?? void 0,
      "data-max": maxSig.value,
      "data-min": minSig.value
    };
  });
  const context = {
    dataAttributesSig,
    valueSig,
    maxSig,
    minSig
  };
  useContextProvider(ProgressContext, context);
  return /* @__PURE__ */ jsx("div", {
    role: "progressbar",
    "aria-label": "progress",
    "aria-valuemax": maxSig.value,
    "aria-valuemin": minSig.value,
    "aria-valuenow": valueSig.value ?? void 0,
    "aria-valuetext": valueLabelSig.value,
    ...dataAttributesSig.value,
    ...rest,
    children: /* @__PURE__ */ jsx(Slot, {})
  });
});
export {
  ProgressRoot
};
