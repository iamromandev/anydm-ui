import { createFocusTrap } from "focus-trap";
import { $ } from "@builder.io/qwik";
import { enableBodyScroll, disableBodyScroll } from "body-scroll-lock-upgrade";
function useModal() {
  const supportClosingAnimation = $((modal) => {
    modal.dataset.closing = "";
    modal.classList.add("modal-closing");
    const { animationDuration, transitionDuration } = getComputedStyle(modal);
    if (animationDuration !== "0s") {
      const handler = (e) => {
        if (e.target === modal) {
          delete modal.dataset.closing;
          modal.classList.remove("modal-closing");
          enableBodyScroll(modal);
          modal.close();
          modal.removeEventListener("animationend", handler);
        }
      };
      modal.addEventListener("animationend", handler);
    } else if (transitionDuration !== "0s") {
      const handler = (e) => {
        if (e.target === modal) {
          delete modal.dataset.closing;
          modal.classList.remove("modal-closing");
          enableBodyScroll(modal);
          modal.close();
          modal.removeEventListener("transitionend", handler);
        }
      };
      modal.addEventListener("transitionend", handler);
    } else if (animationDuration === "0s" && transitionDuration === "0s") {
      delete modal.dataset.closing;
      modal.classList.remove("modal-closing");
      enableBodyScroll(modal);
      modal.close();
    }
  });
  const trapFocus = $((modal) => {
    return createFocusTrap(modal, {
      escapeDeactivates: false
    });
  });
  const activateFocusTrap = $((focusTrap) => {
    try {
      focusTrap?.activate();
    } catch {
    }
  });
  const deactivateFocusTrap = $((focusTrap) => {
    focusTrap?.deactivate();
    focusTrap = null;
  });
  const showModal = $(async (modal) => {
    disableBodyScroll(modal, {
      reserveScrollBarGap: true
    });
    modal.showModal();
  });
  const closeModal = $(async (modal) => {
    await supportClosingAnimation(modal);
  });
  const wasModalBackdropClicked = $((modal, clickEvent) => {
    if (!modal) {
      return false;
    }
    const rect = modal.getBoundingClientRect();
    const wasBackdropClicked = rect.left > clickEvent.clientX || rect.right < clickEvent.clientX || rect.top > clickEvent.clientY || rect.bottom < clickEvent.clientY;
    return clickEvent.pointerId === -1 ? false : wasBackdropClicked;
  });
  return {
    trapFocus,
    activateFocusTrap,
    deactivateFocusTrap,
    showModal,
    closeModal,
    wasModalBackdropClicked,
    supportClosingAnimation
  };
}
export {
  useModal
};
