"use strict";
Object.defineProperty(exports, Symbol.toStringTag, { value: "Module" });
const focusTrap = require("focus-trap");
const qwik = require("@builder.io/qwik");
const bodyScrollLockUpgrade = require("body-scroll-lock-upgrade");
function useModal() {
  const supportClosingAnimation = qwik.$((modal) => {
    modal.dataset.closing = "";
    modal.classList.add("modal-closing");
    const { animationDuration, transitionDuration } = getComputedStyle(modal);
    if (animationDuration !== "0s") {
      const handler = (e) => {
        if (e.target === modal) {
          delete modal.dataset.closing;
          modal.classList.remove("modal-closing");
          bodyScrollLockUpgrade.enableBodyScroll(modal);
          modal.close();
          modal.removeEventListener("animationend", handler);
        }
      };
      modal.addEventListener("animationend", handler);
    } else if (transitionDuration !== "0s") {
      const handler = (e) => {
        if (e.target === modal) {
          delete modal.dataset.closing;
          modal.classList.remove("modal-closing");
          bodyScrollLockUpgrade.enableBodyScroll(modal);
          modal.close();
          modal.removeEventListener("transitionend", handler);
        }
      };
      modal.addEventListener("transitionend", handler);
    } else if (animationDuration === "0s" && transitionDuration === "0s") {
      delete modal.dataset.closing;
      modal.classList.remove("modal-closing");
      bodyScrollLockUpgrade.enableBodyScroll(modal);
      modal.close();
    }
  });
  const trapFocus = qwik.$((modal) => {
    return focusTrap.createFocusTrap(modal, {
      escapeDeactivates: false
    });
  });
  const activateFocusTrap = qwik.$((focusTrap2) => {
    try {
      focusTrap2?.activate();
    } catch {
    }
  });
  const deactivateFocusTrap = qwik.$((focusTrap2) => {
    focusTrap2?.deactivate();
    focusTrap2 = null;
  });
  const showModal = qwik.$(async (modal) => {
    bodyScrollLockUpgrade.disableBodyScroll(modal, {
      reserveScrollBarGap: true
    });
    modal.showModal();
  });
  const closeModal = qwik.$(async (modal) => {
    await supportClosingAnimation(modal);
  });
  const wasModalBackdropClicked = qwik.$((modal, clickEvent) => {
    if (!modal) {
      return false;
    }
    const rect = modal.getBoundingClientRect();
    const wasBackdropClicked = rect.left > clickEvent.clientX || rect.right < clickEvent.clientX || rect.top > clickEvent.clientY || rect.bottom < clickEvent.clientY;
    return clickEvent.pointerId === -1 ? false : wasBackdropClicked;
  });
  return {
    trapFocus,
    activateFocusTrap,
    deactivateFocusTrap,
    showModal,
    closeModal,
    wasModalBackdropClicked,
    supportClosingAnimation
  };
}
exports.useModal = useModal;
