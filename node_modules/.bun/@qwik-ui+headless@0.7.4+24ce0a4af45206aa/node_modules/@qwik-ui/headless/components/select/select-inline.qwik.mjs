import { jsx } from "@builder.io/qwik/jsx-runtime";
import { HSelectImpl } from "./select-root.qwik.mjs";
import { HSelectItem } from "./select-item.qwik.mjs";
import { HSelectItemLabel } from "./select-item-label.qwik.mjs";
import { HSelectErrorMessage } from "./select-error-message.qwik.mjs";
const HSelectRoot = (props) => {
  const { children: myChildren, selectItemComponent: UserItem, selectItemLabelComponent: UserItemLabel, selectErrorMessageComponent: UserErrorMessage, ...rest } = props;
  const SelectItem = UserItem ?? HSelectItem;
  const SelectItemLabel = UserItemLabel ?? HSelectItemLabel;
  const SelectErrorMessage = UserErrorMessage ?? HSelectErrorMessage;
  const itemsMap = /* @__PURE__ */ new Map();
  let currItemIndex = 0;
  let isItemDisabled = false;
  let givenItemValue = null;
  let valuePropIndex = null;
  let isInvalid = false;
  const childrenToProcess = Array.isArray(myChildren) ? [
    ...myChildren
  ] : [
    myChildren
  ];
  while (childrenToProcess.length) {
    const child = childrenToProcess.shift();
    if (!child) {
      continue;
    }
    if (Array.isArray(child)) {
      childrenToProcess.unshift(...child);
      continue;
    }
    switch (child.type) {
      case SelectItem: {
        child.props._index = currItemIndex;
        isItemDisabled = child.props.disabled === true;
        if (child.props.value) {
          givenItemValue = child.props.value;
        }
        if (child.props.children) {
          const childChildren = Array.isArray(child.props.children) ? [
            ...child.props.children
          ] : [
            child.props.children
          ];
          childrenToProcess.unshift(...childChildren);
        }
        break;
      }
      case SelectItemLabel: {
        const displayValue = child.props.children;
        const value = givenItemValue !== null ? givenItemValue : displayValue;
        itemsMap.set(currItemIndex, {
          value,
          displayValue,
          disabled: isItemDisabled
        });
        if (props.value && props.multiple) {
          throw new Error(`Qwik UI: When in multiple selection mode, the value prop is disabled. Use the bind:value prop's initial signal value instead.`);
        }
        if (value === props.value) {
          valuePropIndex = currItemIndex;
        }
        const isString = typeof child.props.children === "string" || typeof child.props.children === "object";
        if (!isString) {
          throw new Error(`Qwik UI: select item label passed was not a string. It was a ${typeof child.props.children}.`);
        }
        currItemIndex++;
        break;
      }
      case SelectErrorMessage: {
        isInvalid = true;
        break;
      }
      default: {
        if (child) {
          const anyChildren = Array.isArray(child.children) ? [
            ...child.children
          ] : [
            child.children
          ];
          childrenToProcess.unshift(...anyChildren);
        }
        break;
      }
    }
  }
  return /* @__PURE__ */ jsx(HSelectImpl, {
    ...rest,
    _valuePropIndex: valuePropIndex,
    _itemsMap: itemsMap,
    invalid: isInvalid,
    children: props.children
  });
};
export {
  HSelectRoot
};
